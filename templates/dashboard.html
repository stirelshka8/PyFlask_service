{% extends 'layout.html' %}

{% block body %}
  <h1>Панель управления</h1>
  <section>
    <h3>Добавление статьи</h3>
    <form method="POST" action="{{ url_for('dashboard') }}" id="article-form">
      <div class="form-group">
        <label for="title">Заголовок статьи:</label>
        <input type="text" id="title" class="form-control" name="title" required>
      </div>
      <div class="form-group">
        <label for="editor">Тело статьи:</label>
        <textarea id="editor" class="form-control" name="{{ form.body.name }}" style="display: none">{{ form.body.data }}</textarea>
        <script>
          ClassicEditor
            .create(document.querySelector('#editor'))
            .catch(error => {
              console.error(error);
            });
        </script>
      </div>
      <button type="submit" class="btn btn-primary">Add Article</button>
    </form>
  </section>

  <section>
    <h3>Your Articles</h3>
    <div class="row">
      {% for article in user_articles.items %}
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">{{ article.title }}</h5>
              <p class="card-text">{{ article.body[:50] }}{% if article.body|length > 50 %}...{% endif %}</p>
              <a href="{{ url_for('display_article', id=article.id) }}" class="btn btn-primary">Read More</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>

  <section>
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        {% for page_num in user_articles.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=3) %}
          {% if page_num %}
            <li class="page-item{% if user_articles.page == page_num %} active{% endif %}">
              <a class="page-link" href="{{ url_for('dashboard', page=page_num) }}">{{ page_num }}</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
          {% endif %}
        {% endfor %}
      </ul>
    </nav>
  </section>

  <script src="{{ url_for('static', filename='ckeditor/ckeditor.js') }}"></script>
  <script>
    ClassicEditor
      .create( document.querySelector( '#editor' ), {
        // toolbar: [ 'heading', '|', 'bold', 'italic', 'link' ]
      } )
      .then( editor => {
        window.editor = editor;
      } )
      .catch( err => {
        console.error( err.stack );
      } );
  </script>
{% endblock %}
